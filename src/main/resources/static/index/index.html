<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能农场环境监控系统</title>
    <link rel="stylesheet" href="index.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* 音乐播放按钮的样式 */
        #musicToggleBtn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            padding: 5px 10px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            /* 确保按钮始终可见 */
            display: block;
        }
    </style>
</head>
<body>
<header>
    <h1 class="logo-image"></h1>

    <nav class="main-nav">
        <ul>
            <li><a href="/login/login.html"><div class="sign-post"><span class="sign-text">注册登录</span></div></a></li>
            <li><a href="/AIChat/chat.html"><div class="sign-post"><span class="sign-text">AI问答</span></div></a></li>
            <li><a href="#"><div class="sign-post"><span class="sign-text">客服中心</span></div></a></li>
            <li><a href="#"><div class="sign-post"><span class="sign-text">联系我们</span></div></a></li>
        </ul>
    </nav>
</header>
<main class="dashboard">

    <section class="status-panel">
        <h2>实时环境状态</h2>
        <div class="metrics">
            <div class="metric-box temperature">
                <h3>温度 (℃)</h3>
                <p id="currentTemp">25.5</p>
            </div>
            <div class="metric-box humidity">
                <h3>湿度 (%)</h3>
                <p id="currentHumid">65</p>
            </div>
            <div class="metric-box ph">
                <h3>pH 值</h3>
                <p id="currentPh">6.5</p>
            </div>
        </div>
    </section>

    <section class="chart-panel">
        <h2>近一小时数据趋势（每分钟更新）</h2>
        <div class="chart-container">
            <canvas id="tempHumidityChart"></canvas>
        </div>
    </section>

    <section class="control-panel">
        <h2>设备操作控制</h2>
        <div class="controls">
            <div class="control-item">
                <h3><span class="water-drop-icon"></span> 自动浇水</h3>
                <p>当前土壤湿度：<span id="soilMoisture">45%</span></p>
                <button id="waterBtn" class="action-btn primary">点击浇水</button>
            </div>
            <div class="control-item">
                <h3><span class="fire-icon"></span> 升温加热</h3>
                <p>目标温度：<input type="number" id="targetTemp" value="28" min="20" max="40"> ℃</p>
                <button id="heatBtn" class="action-btn secondary">升温至目标</button>
            </div>
        </div>
    </section>

    <section class="weather-panel">
        <h2>🌤️ 农场地区天气</h2>
        <div id="weatherInfo">
            <p>正在加载天气数据...</p>
        </div>
        <div class="location-input">
            <label for="cityInput">选择/输入城市：</label>
            <input type="text" id="cityInput" placeholder="例如：北京" value="您的默认城市">
            <button id="getWeatherBtn">更新天气</button>
        </div>
    </section>
</main>

<button id="musicToggleBtn">🎶 播放音乐</button>

<audio id="mcMusic" autoplay loop>
    <source src="/music/mc.mp3" type="audio/mpeg">
    您的浏览器不支持 HTML5 audio 标签。
</audio>

<script>
    const music = document.getElementById('mcMusic');
    const musicBtn = document.getElementById('musicToggleBtn');
    let isPlaying = false; // 初始状态为未播放

    // 播放尝试函数：尝试播放音乐，并更新按钮文本
    function tryPlay() {
        const playPromise = music.play();

        if (playPromise !== undefined) {
            playPromise.then(() => {
                // 播放成功
                console.log("播放成功。");
                // isPlaying 状态和按钮文本由 'playing' 事件监听器更新
            }).catch(error => {
                // 播放失败 (通常是浏览器阻止自动播放)
                console.log("自动播放被阻止:", error);
                isPlaying = false;
                musicBtn.textContent = '🎶 播放音乐';
            });
        }
    }

    // 监听音乐开始播放事件，同步状态和按钮文本
    music.addEventListener('playing', () => {
        isPlaying = true;
        musicBtn.textContent = '⏸ 暂停音乐';
    });

    // 监听音乐暂停事件，同步状态和按钮文本
    music.addEventListener('pause', () => {
        isPlaying = false;
        musicBtn.textContent = '🎶 播放音乐';
    });

    // 1. 网页加载完成后，立即尝试播放 (如果浏览器允许的话)
    tryPlay();

    // 2. 监听音乐控制按钮的点击事件 (这是主要的控制逻辑)
    musicBtn.addEventListener('click', () => {
        if (isPlaying) {
            music.pause();
            // 状态和按钮文本由 'pause' 事件监听器更新
        } else {
            tryPlay();
        }
    });

</script>

<script src="index.js"></script>
</body>
</html>